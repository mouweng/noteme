# 进程与线程

- [进程、线程与协程傻傻分不清？一文带你吃透！](https://mp.weixin.qq.com/s/jhOSjVyRA6rNKqVT2pKMIQ)
- [三分钟基础：用户级线程和内核级线程有什么区别？](https://mp.weixin.qq.com/s/iHQGe2J-4C405CYzBIqXNg)
- [终于有人将进程间通信讲明白了](https://mp.weixin.qq.com/s/3r7k3jKFLHDenh8LO_BD6A)

## 进程

### 进程的定义

> 进程是程序的一次执行过程，是进程实体的运行过程，是系统进行资源分配和调度的一个独立单位。

“你打开网易云音乐回产生一个进程，打开QQ会产生一个进程，你电脑上运行的程序都是进程。”

### 进程的组成

进程实体 = PCB（进程控制块） + 程序段 + 数据段

### PCB的组成

- 进程描述信息（PID进程标识符和UID用户标识符）
- 进程控制和管理信息（进程状态、进程优先级等）
- 资源分配清单（代码段地址、数据段地址、IO设备等）
- CPU相关信息（CPU中各寄存器的值，进程切换时，保存寄存器内容）

### 进程的状态及其变化

![进程状态转换](https://cdn.jsdelivr.net/gh/mouweng/FigureBed/img/20220226163847.png)

一个进程从运行态→阻塞态是主动行为，从阻塞态→就绪态是被动的行为。

### 进程切换

进程的任何操作都是在操作系统内核的支持下运行的，进程切换发生在内核态。

进程切换就是把前一个进程的CPU上下文保存起来，然后加载当前任务的CPU上下文，最后跳转到程序计数器所指的新位置，运行任务。

## 线程

### 线程的定义

>  线程可以理解为轻量级进程。他是CPU执行的基本单元，由线程ID、程序计数器、寄存器集合和堆栈组成。

进程包含许多线程，线程不拥有自己的资源，线程和其他线程共享进程拥有的资源。

### 线程的类别

- 用户级线程

内核意识不到用户级线程的存在，使用线程库设计多线程程序，对于一个进程来说，一个线程阻塞，整个进程都会被阻塞。

- 内核级线程

由操作系统层面实现线程，应用程序没有实现线程管理，但是切换的代价要比用户级线程大。

### 多线程模型

- 多对一模型：效率高，一个线程阻塞整个进程阻塞
- 一对一模型：并发能力强，创建线程开销大
- 多对多模型：综合两者优势

## 进程和线程的区别

|          | 进程                                               | 线程                             |
| -------- | -------------------------------------------------- | -------------------------------- |
| 定义     | 资源分配的基本单位                                 | CPU执行的基本单位                |
| 切换开销 | 大                                                 | 小                               |
| 包含关系 | 进程内可以有多个线程                               | 线程生存在进程内                 |
| 影响关系 | 一个进程崩溃后，在保护模式下不会对其他进程产生影响 | 但是一个线程崩溃整个进程都死掉。 |
| 资源     | 独立的代码空间和内存空间                           | 独立的运行栈和程序计数器         |
| 通信     | IPC                                                | 直接读写数据段                   |

