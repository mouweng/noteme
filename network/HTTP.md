## HTTP协议

> HTTP （HyperText Transfer Protocol）超文本传输协议

## HTTP 常见的状态码

| 状态码类型 | 含义                                             |      |      | 常见状态码    |      |
| ---------- | ------------------------------------------------ | ---- | ---- | ------------- | ---- |
| 1xx        | 提示信息，表示协议处理的中间状态，还有后续操作； |      |      | 100           |      |
| 2xx        | 成功，报文已经收到并正确处理；                   |      |      | 200、201、204 |      |
| 3xx        | 重定向，资源发生变动，需要客户端重新发送连接；   |      |      | 301、302、304 |      |
| 4xx        | 客户端错误，请求报文有误，服务器无法处理         |      |      | 400、403、404 |      |
| 5xx        | 服务器错误，服务器处理请求发生了内部错误         |      |      | 500、502      |      |

- **状态代码 200 OK** ： 请求成功。一般用于GET与POST请求
- **状态代码 201 Created** ： 已创建。成功请求并创建了新的资源
- **状态代码 202 Accepted** ： 已接受。已经接受请求，但未处理完成
- **状态代码 300  Multiple Choices** ： 多种选择。请求的资源可包括多个位置，相应可返回一个资源特征与地址的列表用于用户终端（例如：浏览器）选择
- **状态代码 301  Moved Permanently** ： 永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替
- **状态代码 302 Found** ： 临时移动。与301类似。但资源只是临时被移动。客户端应继续使用原有URI
- **状态代码 400  Bad Request** ：客户端请求的语法错误，服务器无法理解
- **状态代码 401 Unauthorized** ：请求要求用户的身份认证
- **状态代码 403 Forbidden** ： 服务器理解请求客户端的请求，但是拒绝执行此请求
- **状态代码 404 Not Found** ： 服务器无法根据客户端的请求找到资源，通过此代码，网站设计人员可设置"您所请求的资源无法找到"的个性页面
- **状态代码 500 Internal Server Error** ： 服务器内部错误，无法完成请求。
- **状态代码 502  Bad Gateway** ：  作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应

## HTTP常见方法

- GET： 用于请求访问已经被URI（统一资源标识符）识别的资源，可以通过URL传参给服务器
- POST：用于传输信息给服务器，主要功能与GET方法类似，但一般推荐使用POST方式。
- PUT： 传输文件，报文主体中包含文件内容，保存到对应URI位置。
- HEAD： 获得报文首部，与GET方法类似，只是不返回报文主体，一般用于验证URI是否有效。
- DELETE：删除文件，与PUT方法相反，删除对应URI位置的文件。
- OPTIONS：查询相应URI支持的HTTP方法。

### GET和POST的区别

|              | GET                                                | POST   |
| ------------ | -------------------------------------------------- | ------ |
| 数据存放     | URL中                                              | Body中 |
| 数据限制     | 有大小限制，只允许ASCII                            | 无限制 |
| 是否可以缓存 | 能被缓存，保存在浏览器历史记录中，可以被保存为书签 | 不可以 |

## 输入URL到页面加载发生了什么

1. 浏览器分析链接指向页面的URL（http://www.wengyifan.com/index.html）

2. 浏览器向DNS请求解析www.baidu.com的IP地址
3. 域名系统DNS解析出百度服务器的IP地址
4. 浏览器与该服务器建立TCP链接（默认端口位80）
5. 浏览器发送HTTP请求（`GET /index.html`）
6. 服务器通过HTTP响应把文件`index.html`发送给浏览器
7. TCP链接释放
8. 浏览器解析index.html，并显示给用户

### DNS解析过程

> 查找顺序： 浏览器缓存--> 操作系统缓存--> 路由器缓存--> ISP DNS缓存 --> 根DNS服务器./顶级DNS服务器.com./权限域名服务器google.com.

![DNS解析过程](https://cdn.jsdelivr.net/gh/mouweng/FigureBed/img/20220301145609.webp)

- 参考：[从输入URL到页面展示，你想知道些什么？](https://juejin.cn/post/6844903616101220366)

## 无状态协议及解决方案

> HTTP是无状态的。这样设计使得服务器更容易支持大量并发的HTTP请求。

可以通过Cookie和Session解决无状态问题。

### Cookie

客户端发送请求，服务端返回报文时包含一个cookie，客户端再次请求就把这个cookie带上，服务器就知道是这个用户发送了请求。

### Session

客户端发送请求，如果是第一次请求，服务器会为其创建一个session对象，服务器端返回报文时就把这个session的id存储在cookie里面，客户端再次请求就把这个cookie带上，服务器端根据cookile里面的session信息就知道是这个用户发送了请求。

### 对比

cookie存储在客户端，session存储在服务器端，session比cooike安全

session的大小一般没有限制，而cookie的大小会有限制，大概是4MB

cookie的内容只能是asci码，而session没有限制

## HTTP长/短连接

> 当浏览器访问一个包含多张图片的HTML页面时，除了请求访问的HTML页面资源，还会请求图片资源。如果每进行一次HTTP通信都要新建一个TCP连接，那么开销是很大的。

- HTTP1.1之前是默认短连接，如果需要使用长连接，则使用 Connection : Keep-Alive；

- HTTP1.1开始之后，默认是长连接，需要由客户端或者服务器端提出断开，使用 Connection : close。

### 长链接

> 长链接也称作持久连接。持久连接又分为非流水线和流水线两种模式。

- 非流水线方式。客户端在收到前一个响应后才能发出下一个请求。
- 流水线方式。客户端不用等待响应返回，直接发出连续请求。（HTTP1.1默认）



## HTTP1.0/HTTP1.1/HTTP2 新特性

### HTTP1.1相比HTTP1.0的改进

- **长连接和流水线请求**。在一个TCP连接上可以传送多个HTTP请求和响应，减少了建立和关闭连接的消耗和延迟，在HTTP1.1中默认开启Connection： keep-alive，一定程度上弥补了HTTP1.0每次请求都要创建连接的缺点。
- **缓存处理**。引入了更多的缓存控制策略。
- **断点续传原理**。HTTP1.1则在请求头引入了range头域，它允许只请求资源的某个部分，即返回码是206（Partial Content），这样就方便了开发者自由的选择以便于充分利用带宽和连接。
- **错误通知**。在HTTP1.1中新增了24个错误状态响应码，如409（Conflict）表示请求的资源与资源的当前状态发生冲突；410（Gone）表示服务器上的某个资源被永久性的删除。

### HTTP2相比HTTP1.1的改进

- **新的二进制格式**。HTTP/2 不再像 HTTP/1.1 里的纯文本形式的报文，而是全面采用了二进制格式，增加了数据传输的效率。
- **多路复用**。HTTP/2 是可以在一个连接中并发多个请求或回应，而不用按照顺序一一对应。
- **头部压缩**。HTTP/2.0 要求客户端和服务器同时维护和更新一个包含之前见过的首部字段表，从而避免了重复传输。不仅如此，HTTP/2.0 也使用 Huffman 编码对首部字段进行压缩。
- **服务端推送**。HTTP/2 还在一定程度上改善了传统的「请求 - 应答」工作模式，服务不再是被动地响应，也可以主动向客户端发送消息。

## HTTPS和HTTP的区别

|          | HTTP                                 | HTTPS                      |
| -------- | ------------------------------------ | -------------------------- |
| 安全性   | 明文传输，存在被窃听、篡改、冒充风险 | 混合加密+摘要算法+数字证书 |
| 建立连接 | 三次握手+明文传输                    | 三次握手+SSL/TSL+加密传输  |
| 端口号   | 80                                   | 443                        |
| 数字证书 | 不需要                               | 需要                       |

### HTTPS原理

> HTTPS在HTTP与TCP层之间加入了SSL/TLS协议

![HTTPS模型](https://cdn.jsdelivr.net/gh/mouweng/FigureBed/img/20220301194004.jpeg)

HTTP存在如下风险，通过HTTP进行解决：

- 窃听风险：混合加密
- 篡改风险：摘要算法
- 冒充风险：数字证书

先通过HTTP三次握手建立连接，在通过SSL/TLS握手建立连接。SSL/TLS 协议基本流程：

- 客户端向服务器索要并验证服务器的公钥。
- 双方协商生产「会话秘钥」。（客户端随机数+服务端随机数）
- 双方采用「会话秘钥」进行加密通信。

### 混合加密

> HTTPS 采用的是对称加密和非对称加密结合的「混合加密」方式

![对称加密和非对称加密](https://cdn.jsdelivr.net/gh/mouweng/FigureBed/img/20220301194607.png)

- 在通信建立前采用非对称加密的方式交换「会话秘钥」，后续就不再使用非对称加密。

- 在通信过程中全部使用对称加密的「会话秘钥」的方式加密明文数据。

采用「混合加密」的方式的原因：

- 对称加密只使用一个密钥，运算速度快，密钥必须保密，无法做到安全的密钥交换。
- 非对称加密使用两个密钥：公钥和私钥，公钥可以任意分发而私钥保密，解决了密钥交换问题但速度慢。

### 摘要算法

> 摘要算法用来实现完整性，能够为数据生成独一无二的「指纹」，用于校验数据的完整性，解决了篡改的风险。

![摘要算法](https://cdn.jsdelivr.net/gh/mouweng/FigureBed/img/20220301194821.jpeg)

### 数字证书

> 通过数字证书的方式保证服务器公钥的身份，解决冒充的风险。

借助第三方权威机构 CA （数字证书认证机构），将服务器公钥放在数字证书（由数字证书认证机构颁发）中，只要证书是可信的，公钥就是可信的。

![数字证书](https://cdn.jsdelivr.net/gh/mouweng/FigureBed/img/20220301194921.jpeg)

